steps:
- task: UseDotNet@2
  displayName: 'Use .Net Core sdk 3.1.x'
  inputs:
    version: 3.1.x

- task: DotNetCoreCLI@2
  displayName: 'Run `dotnet restore`'
  inputs:
    command: restore
    projects: '$(WorkingDirectory)\*.csproj'
    feedsToUse: config
    nugetConfigPath: packages\NuGet.Config

- task: DotNetCoreCLI@2
  displayName: 'Run `dotnet build`'
  inputs:
    command: build
    projects: '$(WorkingDirectory)\*.csproj'
    arguments: '--configuration $(BuildConfiguration) --no-restore'
    workingDirectory: '$(WorkingDirectory)'

- task: DotNetCoreCLI@2
  displayName: 'Run `dotnet publish`'
  inputs:
    command: publish
    projects: '$(WorkingDirectory)\*.csproj'
    arguments: '--configuration $(BuildConfiguration) --no-restore --output $(Build.ArtifactStagingDirectory)\binaries'
    workingDirectory: '$(WorkingDirectory)'

- task: DotNetCoreCLI@2
  displayName: 'Run `dotnet pack`'
  inputs:
    command: 'pack'
    packagesToPack: '$(WorkingDirectory)\*.csproj'
    packDirectory: '$(Build.ArtifactStagingDirectory)\outputpackages'
    versioningScheme: 'off'

- task: PublishBuildArtifacts@1
  displayName: 'Publish the binaries'
  inputs:
    PathtoPublish: '$(Build.ArtifactStagingDirectory)\binaries'    
    ArtifactName: 'binaries'
    publishLocation: 'Container'