parameters:
- name: componentType
  displayName: 'What type of component?'
  type: string
  values:
  - declarativeAsset
  - codeExtension
  - generator

- name: deploymentRing
  displayName: 'What deployment ring is the package in?'
  type: string
  values:
  - alpha
  - preview
  - release

stages:
  - ${{ if eq(parameters.deploymentRing, 'alpha') }}: 
    - powershell: |
        Write-Host "ALPHA"
        $deploymentRing = 'alpha';
        Write-Host "##vso[task.setvariable variable=DeploymentRing;]$deploymentRing";
        Write-Host "Set environment variable to ($env:DeploymentRing)"

  - ${{ if eq(parameters.deploymentRing, 'preview') }}: 
    - powershell: |
        Write-Host "PREVIEW"
        $deploymentRing = 'preview';
        Write-Host "##vso[task.setvariable variable=DeploymentRing;]$deploymentRing";
        Write-Host "Set environment variable to ($env:DeploymentRing)"

  - ${{ if eq(parameters.deploymentRing, 'release') }}: 
    - powershell: |
        Write-Host "RELEASE"
        $deploymentRing = 'release';
        Write-Host "##vso[task.setvariable variable=DeploymentRing;]$deploymentRing";
        Write-Host "Set environment variable to ($env:DeploymentRing)"

  - ${{ if eq(parameters.componentType, 'codeExtension') }}: 
    - stage: Build_pack
      displayName: Build and package
      jobs:
        - job: Build
          displayName: Build and package
          steps:
          - template: versioning-steps.yml
          - template: dotnet-package-steps.yml

  # Publish both nuget and node packages
  # Use `nuget` instead of `dotnet` due to dependency on .nuspec file
  - ${{ if eq(parameters.componentType, 'declarativeAsset') }}: 
    - stage: Build_pack
      displayName: Build and package
      jobs:
        - job: Nuget_pack
          displayName: Create nuget package
          steps:
          - template: versioning-steps.yml
          - template: nuspec-package-steps.yml
        - job: Npm_pack
          displayName: Create npm package
          steps:
          - template: versioning-steps.yml
          - template: npm-package-steps.yml

  - ${{ if eq(parameters.componentType, 'generator') }}: 
    - stage: Build_pack
      displayName: Build and package
      jobs:
        - job: NpmPack
          displayName: Create npm package
          steps:
          - template: versioning-steps.yml
          - template: npm-package-steps.yml