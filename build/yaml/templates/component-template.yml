stages:
  - stage: Build_pack_code
    displayName: Build and package code
    condition: eq(variables.ComponentType, 'codeExtension')
    jobs:
      - job: Build
        displayName: Build and package
        steps:
        - template: versioning-steps.yml
        - template: dotnet-package-steps.yml

  # Publish both nuget and node packages
  # Use `nuget` instead of `dotnet` due to dependency on .nuspec file
  - stage: Build_pack_assets
    displayName: Build and package declarative assets
    condition: eq(variables.ComponentType, 'declarativeAsset')
    jobs:
      - job: Nuget_pack
        displayName: Create nuget package
        steps:
        - template: versioning-steps.yml
        - template: nuspec-package-steps.yml
      - job: Npm_pack
        displayName: Create npm package
        steps:
        - template: versioning-steps.yml
        - template: npm-package-steps.yml

  - stage: Build_pack_generators
    displayName: Build and package generator
    condition: eq(variables.ComponentType, 'generator')
    jobs:
      - job: NpmPack
        displayName: Create npm package
        steps:
        - template: versioning-steps.yml
        - template: npm-package-steps.yml